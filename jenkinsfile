node('slaves')
{

properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')), 
pipelineTriggers([pollSCM('* * * * *')])])

def mavenHome = tool name: "maven 3.8.2"

stage('checkOutCode')
{
git branch: 'dev', credentialsId: '790d9d01-86d2-48df-b2a9-72f18105394b',
 url: 'https://github.com/ramyaravindra-ec-apps/maven-web-application.git'
}
stage('Build')
{
    sh "${mavenHome}/bin/mvn clean package" 

}
/*
stage('ExecuteSonarQubeReport')
{
sh "${mavenHome}/bin/mvn clean package sonar:sonar"
}
*/
stage('Upload Artifact To Nexus')
{
sh "${mavenHome}/bin/mvn deploy"
}
stage('DeployToTomcat')
{
sshagent(['7f075cae-dccc-4910-9139-94e291580778'])
 {
    sh "scp  -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@54.152.205.58:/opt/apache-tomcat-9.0.53/webapps/"

}
}

}
